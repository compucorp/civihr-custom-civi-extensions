define(['controllers/controllers'], function(controllers){    controllers.controller('ExampleCtrl',['$scope', '$log', '$routeParams', 'ExampleService', '$route', '$timeout',        function($scope, $log, $routeParams, ExampleService, $route, $timeout){            $log.debug('Controller: ExampleCtrl');            // Validate fields            $scope.validateTitle = function(data) {                console.log(data);                if (data == 'title' || data == ' ') {                    return "Title cannot be title!";                }            };            // Tracks collapsed / expanded rows            $scope.collapsedRows = [];            // Tracks clicked tabs per each row            $scope.view_tab = [];            // Tracks edit data changes on the forms            $scope.edit_data = {};            // Set the filter to show only the Active items as default            $scope.currentFilterId = 1;            // Define the add new role URL            $scope.add_new_role_url = $scope.$parent.pathBaseUrl + $scope.$parent.pathIncludeTpl + 'add_new_role.html';            // Store the contractsData            $scope.contractsData = [];            // Implement angular tabs            $scope.changeTab = function(row_id, tab_id) {                $scope.view_tab[row_id] = tab_id;            };            // Check if current tab            $scope.isTab = function(row_id, tab_id) {                if ($scope.view_tab[row_id] == tab_id) {                    return true;                }                return false;            };            // Check for collapsed rows            $scope.isThingsCollapsed = function(row_id) {                if ($scope.collapsedRows[row_id] == true) {                    return true;                }                else if ($scope.collapsedRows[row_id] == false) {                    return false;                }                return true;            };            // Collapse the row or Expand when clicked            $scope.collapseRow = function(row_id) {                // If already collapsed, expand                if ($scope.collapsedRows[row_id] == false) {                    $scope.collapsedRows[row_id] = true;                }                else {                    $scope.collapsedRows[row_id] = false;                }            };            // Set the data from the webservice call            $scope.initData = function(row_id, form_id, data) {                // Check if we have the array already                if (typeof $scope.edit_data[row_id] == "undefined") {                    $scope.edit_data[row_id] = {};                }                $scope.edit_data[row_id][form_id] = data;            }            // Check if the data are changed in the form (based on job role ID)            $scope.isChanged = function(row_id) {                // If there are data it means we edited the form                if ($scope.edit_data[row_id]['is_edit'] == true) {                    return true;                }                return false;            }            // Set the is_edit value            $scope.showSave = function(row_id) {                console.log($scope.edit_data);                $scope.edit_data[row_id]['is_edit'] = true;            }            // Saves the new Job Role            $scope.saveNewRole = function(data) {                $log.debug('Add New Role');                // Create the new job role                createJobRole($scope.edit_data.new_role_id);                // Get job roles based on the passed Contact ID (refresh part of the page)                getJobRolesList($scope.$parent.contactId);                // Hide the add new form                $scope.add_new = false;                // Hide the empty message if visible                $scope.empty = false;            };            // Sets the add new job role form visibility            $scope.add_new_role = function() {                $scope.add_new = true;            }            // Removes the Role based on Role ID            $scope.removeRole = function(row_id) {                $log.debug('Remove Role');                // Delete job role                deleteJobRole(row_id);                // Get job roles based on the passed Contact ID (refresh part of the page)                getJobRolesList($scope.$parent.contactId);            };            $scope.updateRole = function(role_id) {                $log.debug('Update Role');                console.log(role_id);                console.log($scope.edit_data[role_id]);                // Update the job role                updateJobRole(role_id, $scope.edit_data[role_id]);                // Get job roles based on the passed Contact ID (refresh part of the page)                getJobRolesList($scope.$parent.contactId);            }            // Select list for Status options            $scope.filterItems = [ {id: 1, name: 'Active'}, {id: 2, name: 'Inactive'}];            // Select list for Funder Types            $scope.funderTypes = [ {id: 0, name: 'Fixed'}, {id: 1, name: '%'}];            $scope.filterChange = function() {                $scope.currentFilterId = $scope.currentFilter.id;                console.log($scope.currentFilterId, $scope.currentFilter);            }            // Show funder Type default value            $scope.showFunderType = function(funder) {                var selected = '';                if(typeof funder.type !== "undefined") {                    // Get the human readable Funder Type Value                    selected = $scope.funderTypes[funder.type];                    return selected.name;                }                return 'Not set';            }            // Add new funder row            $scope.addFunderRow = function(role_id) {                // Check if we have the array already                if (typeof $scope.edit_data[role_id] == "undefined") {                    $scope.edit_data[role_id] = {};                }                // Check if we have the array already                if (typeof $scope.edit_data[role_id]['funders'] == "undefined" || !($scope.edit_data[role_id]['funders'] instanceof Array)) {                    $scope.edit_data[role_id]['funders'] = [];                }                $scope.edit_data[role_id]['funders'].push({                    id: $scope.edit_data[role_id]['funders'].length + 1,                    funder_id: '',                    type: 1,                    percentage: null,                    amount: true                });            };            // Delete funder row            $scope.deleteFunderRow = function(role_id, funder_row_id) {                // Remove the funder row                $scope.edit_data[role_id]['funders'].splice(funder_row_id, 1);            };            // Variable to check if we adding new job role            var job_roles = this;            // Get job roles based on the passed Contact ID            getJobRolesList($scope.$parent.contactId);            // Get Job Contracts based on the passed Contact ID            function getContracts(contact_id) {                ExampleService.getContracts(contact_id).then(function(data){                        console.log(data);                },                function(errorMessage){                    $scope.error = errorMessage;                });            }            // Implements the "getAllJobRoles" service            function getJobRolesList(contact_id) {                // Get the job contracts for the contact                ExampleService.getContracts(contact_id).then(function(data){                        console.log(data);                        var job_contract_ids = [];                        var contractsData = {};                        // If we have job contracts, try to get the job roles for the contract                        if (data.count != 0) {                            for (var i = 0; i < data.count; i++) {                                console.log(data.values[i]['id']);                                // Job contract IDs which will be passed to the "getAllJobRoles" service                                job_contract_ids.push(data.values[i]['id']);                                                                contractsData[data.values[i]['id']] = {id: data.values[i]['id'], title: data.values[i]['title']};                            }                            // Store the ContractsData what we can reuse later                            job_roles.contractsData = contractsData;                            ExampleService.getAllJobRoles(job_contract_ids).then(function(data){                                    job_roles.getData = data.values;                                    if (data.is_error == 1) {                                        job_roles.status = 'Data load failure';                                    }                                    else {                                        if (data.count == 0) {                                            job_roles.empty = 'No Job Roles found!';                                        }                                        else {                                            job_roles.empty = null;                                        }                                        console.log(job_roles);                                        job_roles.status = 'Data load OK';                                    }                            },                            function(errorMessage){                                $scope.error = errorMessage;                            });                        }                        else {                            console.log('no job contract');                            job_roles.empty = 'No Job Contracts found for this Contact!';                        }                },                function(errorMessage){                    $scope.error = errorMessage;                });            }            // Implements the "deleteJobRole" service            function deleteJobRole(job_role_id) {                ExampleService.deleteJobRole(job_role_id).then(function(data){                        if (data.is_error == 1) {                            job_roles.message_type = 'alert-danger';                            job_roles.message = 'Role delete failure!';                        }                        else {                            job_roles.message_type = 'alert-success';                            job_roles.message = 'Role deleted successfully!';                        }                        // Hide the message after some seconds                        $timeout(function() {                            job_roles.message = null;                        }, 3000);                    },                    function(errorMessage){                        $scope.error = errorMessage;                    });            }            // Implements the "createJobRole" service            function createJobRole(job_roles_data) {                ExampleService.createJobRole(job_roles_data).then(function(data){                        if (data.is_error == 1) {                            job_roles.message_type = 'alert-danger';                            job_roles.message = 'Role creation failed!';                        }                        else {                            job_roles.message_type = 'alert-success';                            job_roles.message = 'Role added successfully!';                        }                        // Hide the message after some seconds                        $timeout(function() {                            job_roles.message = null;                        }, 3000);                    },                    function(errorMessage){                        $scope.error = errorMessage;                    });            }            // Implements the "updateJobRole" service            function updateJobRole(role_id, job_roles_data) {                ExampleService.updateJobRole(role_id, job_roles_data).then(function(data){                        if (data.is_error == 1) {                            job_roles.message_type = 'alert-danger';                            job_roles.message = 'Role update failed!';                        }                        else {                            job_roles.message_type = 'alert-success';                            job_roles.message = 'Role updated successfully!';                        }                        // Hide the message after some seconds                        $timeout(function() {                            job_roles.message = null;                        }, 3000);                    },                    function(errorMessage){                        $scope.error = errorMessage;                    });            }        }]);});